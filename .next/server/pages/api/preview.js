"use strict";(()=>{var e={};e.id=157,e.ids=[157],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6681:e=>{e.exports=require("playwright")},7147:e=>{e.exports=require("fs")},6529:(e,t,a)=>{a.r(t),a.d(t,{config:()=>c,default:()=>n,routeModule:()=>u});var o={};a.r(o),a.d(o,{default:()=>handler});var r=a(1802),i=a(7153),l=a(6249);let{scrapeTiktokProfile:s}=a(8596);async function handler(e,t){let{url:a,startDate:o,endDate:r}=e.query;if(!a||!o||!r)return t.status(400).json({error:"Semua parameter (url, startDate, endDate) wajib diisi!"});let i=a.match(/tiktok\.com\/@([\w.-]+)/);if(!i)return t.status(400).json({error:"Link TikTok tidak valid! Format harus seperti https://www.tiktok.com/@username"});let l=i[1];console.log("\uD83D\uDCE5 Request received with params:",{url:a,startDate:o,endDate:r}),console.log("\uD83D\uDD0D Username extracted:",l);try{let e=await s(l,o,r);console.log("✅ Data berhasil diambil:",{username:e.username,total:e.total,estSize:e.estSize}),t.status(200).json(e)}catch(e){console.error("❌ Scraper error:",e.message),t.status(500).json({error:"Gagal fetch data dari TikTok, coba beberapa saat lagi"})}}let n=(0,l.l)(o,"default"),c=(0,l.l)(o,"config"),u=new r.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/preview",pathname:"/api/preview",bundlePath:"",filename:""},userland:o})},8596:(e,t,a)=>{let{chromium:o}=a(6681),r=a(7147);async function scrapeTiktokProfile(e,t,a){let i=await o.launch({headless:!0}),l=await i.newContext();if(r.existsSync("tiktok-cookies.json")){let e=JSON.parse(r.readFileSync("tiktok-cookies.json"));await l.addCookies(e),console.log("\uD83C\uDF6A Cookies loaded!")}let s=await l.newPage(),n=`https://www.tiktok.com/@${e}`;try{await s.goto(n,{waitUntil:"networkidle"}),await s.waitForSelector("h1");let e=await s.$eval("h1",e=>e.innerText),o=await s.$eval('img[src*="tiktok"]',e=>e.src),r=new Set,c=0;for(;;){let e=await s.$$eval('a[href*="/video/"]',e=>e.map(e=>e.href));e.forEach(e=>r.add(e));let t=await s.evaluate(()=>(window.scrollTo(0,document.body.scrollHeight),document.body.scrollHeight));if(t===c)break;c=t,await s.waitForTimeout(3e3)}let u=new Date(t).getTime(),d=new Date(a).getTime(),w=[];for(let e of(console.log(`🔗 Total link ditemukan: ${r.size}`),r)){let t=await l.newPage();try{await t.goto(e,{waitUntil:"domcontentloaded"});let a=await t.evaluate(()=>{let e=[...document.querySelectorAll("script")].find(e=>e.textContent.includes("__UNIVERSAL_DATA__"));if(!e)return null;let t=e.textContent.match(/window\.__UNIVERSAL_DATA__\s*=\s*({.*});/);if(!t)return null;let a=JSON.parse(t[1]);return a?.SEOState?.itemList?.[0]||null});if(!a||!a.createTime){console.warn("❌ Gagal ambil videoData:",e),await t.close();continue}let o=1e3*a.createTime;o>=u&&o<=d&&w.push({url:e,uploadDate:new Date(o).toISOString(),description:a.desc||"",thumbnail:a.cover||""})}catch(t){console.warn("❌ Error fetch video:",e,t.message)}finally{await t.close()}}return await i.close(),console.log(`📂 Total video valid: ${w.length}`),w.forEach((e,t)=>{console.log(`🎬 [${t+1}] ${e.uploadDate} — ${e.url}`)}),{username:e,avatar:o,total:w.length,estSize:`${5*w.length} MB`,videos:w}}catch(e){throw await i.close(),console.error("❌ Scraper error:",e.message),Error("Gagal mengambil data dari TikTok")}}e.exports={scrapeTiktokProfile}}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[222],()=>__webpack_exec__(6529));module.exports=a})();