"use strict";(()=>{var e={};e.id=51,e.ids=[51],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7147:e=>{e.exports=require("fs")},1117:(e,r,i)=>{i.r(r),i.d(r,{config:()=>y,default:()=>v,routeModule:()=>w});var t={};i.r(t),i.d(t,{default:()=>handler});var a=i(1802),n=i(7153),o=i(6249),l=i(7147),s=i.n(l);let d=require("path");var p=i.n(d);let c=require("archiver");var u=i.n(c);let m=require("util"),f=require("child_process"),h=(0,m.promisify)(f.exec);async function handler(e,r){if("POST"!==e.method)return r.status(405).json({error:"Only POST allowed"});let{links:i}=e.body;if(!Array.isArray(i)||0===i.length)return r.status(400).json({error:"No video links provided"});let t=p().join(process.cwd(),"tmp");s().existsSync(t)||s().mkdirSync(t);let a=[];for(let e=0;e<i.length;e++){let r=i[e],n=`video_${e+1}.mp4`,o=p().join(t,n);try{console.log(`🔗 Memproses: ${r}`),await h(`yt-dlp -o "${o}" "${r}"`);let e=s().statSync(o);if(e.size<1e6){console.warn(`⚠️ File terlalu kecil / corrupt: ${n} (${e.size} bytes)`),s().unlinkSync(o);continue}a.push(o)}catch(e){console.warn(`⚠️ Gagal download: ${r}`,e.message)}}if(0===a.length)return r.status(500).json({error:"Tidak ada video yang berhasil di-download"});let n=p().join(t,"videos.zip"),o=s().createWriteStream(n),l=u()("zip",{zlib:{level:9}});l.pipe(o),a.forEach(e=>{l.file(e,{name:p().basename(e)})}),await l.finalize(),o.on("close",()=>{r.setHeader("Content-Type","application/zip"),r.setHeader("Content-Disposition",'attachment; filename="videos.zip"');let e=s().createReadStream(n);e.pipe(r)})}let v=(0,o.l)(t,"default"),y=(0,o.l)(t,"config"),w=new a.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/download",pathname:"/api/download",bundlePath:"",filename:""},userland:t})}};var r=require("../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),i=r.X(0,[222],()=>__webpack_exec__(1117));module.exports=i})();